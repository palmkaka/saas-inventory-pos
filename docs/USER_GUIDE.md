# 📋 คู่มือการใช้งานระบบ SaaS POS

## 🎯 หลักการทำงาน

ระบบนี้เป็น **SaaS POS (Point of Sale)** สำหรับจัดการธุรกิจร้านค้าปลีก ออกแบบเป็น **Multi-tenant** คือหลายร้านค้าใช้ระบบเดียวกันได้ แต่ข้อมูลแยกกันตาม `organization_id`

```
┌─────────────────────────────────────────────────────────┐
│                    SaaS POS System                      │
├─────────────────────────────────────────────────────────┤
│  ร้าน A (org_1)    │  ร้าน B (org_2)   │  ร้าน C (org_3) │
│  - สินค้า A        │  - สินค้า B       │  - สินค้า C      │
│  - ออเดอร์ A       │  - ออเดอร์ B      │  - ออเดอร์ C     │
│  - ค่าใช้จ่าย A    │  - ค่าใช้จ่าย B   │  - ค่าใช้จ่าย C  │
└─────────────────────────────────────────────────────────┘
```

---

## 👥 ประเภทผู้ใช้งาน (Roles)

ระบบแบ่งผู้ใช้เป็น 3 ระดับตามสิทธิ์การเข้าถึง:

| Role | คำอธิบาย | สิทธิ์การใช้งาน |
|------|----------|-----------------|
| **OWNER** | เจ้าของร้าน | เข้าถึงได้ทุกอย่าง, แก้ไขตั้งค่าองค์กร, ดูรายงานทั้งหมด, จัดการผู้ใช้ |
| **MANAGER** | ผู้จัดการ | จัดการสินค้า, ดูรายงาน, บันทึกค่าใช้จ่าย, ดูงบกำไรขาดทุน |
| **STAFF** | พนักงาน | ขายสินค้าหน้าร้าน (POS เท่านั้น) |

### การจัดการสิทธิ์

```
OWNER (เจ้าของ)
├── สามารถทำได้ทุกอย่าง
├── แก้ไขข้อมูลองค์กร
└── ดู/แก้ไข ผู้ใช้ทั้งหมด

MANAGER (ผู้จัดการ)
├── จัดการสินค้า (เพิ่ม/แก้ไข/ลบ)
├── ดูรายงานยอดขาย
├── บันทึกค่าใช้จ่าย
└── ขายสินค้า (POS)

STAFF (พนักงาน)
└── ขายสินค้า (POS เท่านั้น)
```

---

## 📱 โมดูลหลักของระบบ

### 1. ภาพรวม (Dashboard)
**เส้นทาง:** `/dashboard`

แสดงสรุปข้อมูลสำคัญของธุรกิจ:
- 💰 ยอดขายรวม
- 📈 กำไรสุทธิ
- 📦 จำนวนออเดอร์
- ⚠️ สินค้าใกล้หมด
- 📊 กราฟวิเคราะห์ยอดขาย
- 🕐 ออเดอร์ล่าสุด

---

### 2. ขายสินค้า (POS)
**เส้นทาง:** `/dashboard/pos`

ระบบขายหน้าร้านแบบ iPad-like:
- 🔍 ค้นหาสินค้าด้วยชื่อ, SKU, หมวดหมู่
- 🛒 เพิ่มสินค้าในตะกร้า (คลิกที่สินค้า)
- ➕➖ ปรับจำนวนสินค้า
- 💳 ชำระเงินและบันทึกออเดอร์
- 📉 หักสต็อกอัตโนมัติ

**Flow การขาย:**
```
เลือกสินค้า → เพิ่มในตะกร้า → ปรับจำนวน → ชำระเงิน → บันทึกออเดอร์ → หักสต็อก
```

---

### 3. คลังสินค้า (Inventory)
**เส้นทาง:** `/dashboard/inventory`

จัดการสินค้าทั้งหมด:
- 📋 ดูรายการสินค้า (ชื่อ, หมวดหมู่, ราคา, สต็อก)
- ➕ เพิ่มสินค้าใหม่ `/dashboard/inventory/new`
- ✏️ แก้ไขสินค้า `/dashboard/inventory/[id]`
- 🗑️ ลบสินค้า

**Dynamic Fields:**
ระบบรองรับฟิลด์แบบไดนามิกตามหมวดหมู่ เช่น:
- หมวด "อิเล็กทรอนิกส์" → ขนาดหน้าจอ, ความจุ, สี
- หมวด "เสื้อผ้า" → ไซส์, สี, วัสดุ

---

### 4. ค่าใช้จ่าย (Expenses)
**เส้นทาง:** `/dashboard/expenses`

บันทึกค่าใช้จ่ายตามโครงสร้าง P&L:

| กลุ่ม | รหัส | ประเภทย่อย |
|-------|------|------------|
| **ต้นทุนขาย** | COST | ค่าระบบ (HMS), ค่าอุปกรณ์ |
| **ค่าใช้จ่ายการขาย** | SELLING | ค่าโฆษณา, คอมมิชชั่น, Incentive |
| **ค่าใช้จ่ายบริหาร** | ADMIN | เงินเดือน, ค่าเช่า, ค่าน้ำค่าไฟ, ค่าทำความสะอาด, ค่าไปรษณีย์ |

**หมายเหตุ:** ถ้าเลือกประเภท "คอมมิชชั่น" จะต้องระบุ "ชื่อผู้รับเงิน"

---

### 5. รายงาน (Reports)
**เส้นทาง:** `/dashboard/reports`

แสดงรายงานยอดขาย:
- 💵 ยอดขายรวม
- 📦 จำนวนออเดอร์ทั้งหมด
- ✅ ออเดอร์สำเร็จ
- 📋 ตารางประวัติออเดอร์

---

### 6. งบกำไรขาดทุน (P&L Report)
**เส้นทาง:** `/dashboard/reports/pnl`

แสดงงบกำไรขาดทุนรายเดือน:

| รายการ | คำอธิบาย |
|--------|----------|
| **รายได้ (Revenue)** | ยอดขายจากตาราง `orders` |
| **ต้นทุนขาย (COGS)** | ค่าใช้จ่ายกลุ่ม COST |
| **กำไรขั้นต้น** | รายได้ - ต้นทุนขาย |
| **ค่าใช้จ่ายการขาย** | ค่าใช้จ่ายกลุ่ม SELLING |
| **ค่าใช้จ่ายบริหาร** | ค่าใช้จ่ายกลุ่ม ADMIN |
| **กำไรสุทธิ** | กำไรขั้นต้น - ค่าใช้จ่ายทั้งหมด |

**ตารางแสดง:** รายการ (แถว) vs เดือน ม.ค.-ธ.ค. (คอลัมน์) + รวมทั้งปี

---

### 7. ตั้งค่า (Settings)
**เส้นทาง:** `/dashboard/settings`

แก้ไขข้อมูลองค์กร:
- 🏪 ชื่อร้าน
- 🔢 เลขประจำตัวผู้เสียภาษี
- 📍 ที่อยู่
- 📞 เบอร์โทรศัพท์
- 📧 อีเมล

---

## 🗃️ โครงสร้างฐานข้อมูล (Supabase)

```
organizations          → ข้อมูลร้าน/องค์กร
    │
    ├── profiles       → ข้อมูลผู้ใช้ + role
    │
    ├── categories     → หมวดหมู่สินค้า
    │   └── category_field_definitions → ฟิลด์ไดนามิก
    │
    ├── products       → สินค้า
    │   └── attributes (JSONB) → ข้อมูลไดนามิก
    │
    ├── orders         → ออเดอร์ (ยอดขาย)
    │   └── order_items → รายการสินค้าในออเดอร์
    │
    └── expenses       → ค่าใช้จ่าย
        ├── expense_group (COST/SELLING/ADMIN)
        ├── expense_type
        └── recipient_name (สำหรับคอมมิชชั่น)
```

---

## 🔐 ระบบรักษาความปลอดภัย

| ระบบ | คำอธิบาย |
|------|----------|
| **Authentication** | Login ด้วย Email/Password ผ่าน Supabase Auth |
| **Middleware** | ตรวจสอบ session ก่อนเข้าหน้า `/dashboard/*` |
| **Data Isolation** | ข้อมูลถูกกรองตาม `organization_id` เสมอ |
| **RLS** | Row Level Security ใน Supabase (ระดับ Database) |

---

## 🔄 Flow การใช้งาน

```
                        ┌──────────────────┐
                        │   Login Page     │
                        │  (เข้าสู่ระบบ)   │
                        └────────┬─────────┘
                                 │
                        ┌────────▼─────────┐
                        │    Dashboard     │
                        │   (ภาพรวม)       │
                        └────────┬─────────┘
                                 │
            ┌────────────────────┼────────────────────┐
            │                    │                    │
    ┌───────▼────────┐  ┌────────▼────────┐  ┌────────▼────────┐
    │   ขายสินค้า    │  │   คลังสินค้า    │  │   ค่าใช้จ่าย    │
    │     (POS)      │  │   (Inventory)   │  │   (Expenses)    │
    └───────┬────────┘  └────────┬────────┘  └────────┬────────┘
            │                    │                    │
            │         ┌──────────▼──────────┐         │
            └─────────►      รายงาน         ◄─────────┘
                      │   (Reports/P&L)     │
                      └─────────────────────┘
```

---

## 🚀 การติดตั้งและใช้งาน

### ความต้องการ
- Node.js 18+
- Supabase Account
- npm หรือ yarn

### ขั้นตอนการติดตั้ง

```bash
# 1. Clone โปรเจค
git clone <repository-url>
cd saas-inventory-pos

# 2. ติดตั้ง dependencies
npm install

# 3. ตั้งค่า environment variables
# สร้างไฟล์ .env.local แล้วใส่:
NEXT_PUBLIC_SUPABASE_URL=<your-supabase-url>
NEXT_PUBLIC_SUPABASE_ANON_KEY=<your-anon-key>

# 4. รัน schema.sql ใน Supabase SQL Editor

# 5. เริ่มต้น development server
npm run dev
```

### การเข้าถึง
- **Development:** http://localhost:3000
- **Login:** ใช้ Email/Password ที่ลงทะเบียนใน Supabase Auth

---

## 📝 หมายเหตุ

- ระบบใช้ **Next.js 15** (App Router)
- ใช้ **Tailwind CSS** สำหรับ styling
- ใช้ **Supabase** สำหรับ Authentication และ Database
- UI เป็น **ภาษาไทย** ทั้งหมด

---

*เอกสารนี้ปรับปรุงล่าสุด: มกราคม 2026*
